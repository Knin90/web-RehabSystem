{% extends "admin/base_admin.html" %}

{% block title %}Terapeutas - RehabSystem{% endblock %}
{% block page_title %}Administración de Terapeutas{% endblock %}
{% block page_description %}Visualiza y administra todos los terapeutas del sistema.{% endblock %}

{% block content %}

<!-- Botón para agregar terapeuta -->
<div class="mb-4">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTherapistModal">
        <i class="fas fa-plus"></i> Agregar Terapeuta
    </button>
</div>

<div class="card-custom p-4">

    <h4>Resumen General</h4>
    <p class="text-muted mb-4">Estado actual del personal de terapia.</p>

    <div class="progress-grid mb-4">
        <div class="progress-card">
            <div class="progress-number">{{ therapists|length }}</div>
            <div class="progress-label">Total Terapeutas</div>
        </div>
        <div class="progress-card">
            <div class="progress-number">{{ active_therapists }}</div>
            <div class="progress-label">Activos</div>
        </div>
    </div>

    <h4 class="mt-4">Lista de Terapeutas</h4>

    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre Completo</th>
                    <th>Usuario</th>
                    <th>Email</th>
                    <th>Especialidad</th>
                    <th>Pacientes</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for therapist in therapists %}
                <tr>
                    <td>{{ therapist.id }}</td>
                    <td>{{ therapist.nombre_completo }}</td>
<td>{{ therapist.usuario.nombre_usuario }}</td>
                    <td>{{ therapist.usuario.correo_electronico }}</td>
                    <td>{{ therapist.especialidad or 'N/A' }}</td>
                    <td>{{ therapist.total_pacientes }}</td>
                    <td>
                        {% if therapist.usuario.esta_activo %}
                            <span class="badge bg-success">Activo</span>
                        {% else %}
                            <span class="badge bg-secondary">Inactivo</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info" data-action="view" data-id="{{ therapist.id }}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" data-action="edit" data-id="{{ therapist.id }}">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="text-center text-muted">No hay terapeutas registrados</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<!-- Modal para agregar terapeuta -->
<div class="modal fade" id="addTherapistModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-md"></i> Agregar Nuevo Terapeuta
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('add_therapist') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nombre Completo *</label>
                        <input type="text" class="form-control" name="full_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nombre de Usuario *</label>
                        <input type="text" class="form-control" name="username" required>
                        <small class="text-muted">Sin espacios, solo letras y números</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contraseña *</label>
                        <input type="password" class="form-control" name="password" required minlength="6">
                        <small class="text-muted">Mínimo 6 caracteres</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Especialidad</label>
                        <select class="form-select" name="specialty">
                            <option value="">Seleccionar...</option>
                            <option value="Fisioterapia General">Fisioterapia General</option>
                            <option value="Rehabilitación Deportiva">Rehabilitación Deportiva</option>
                            <option value="Terapia Neurológica">Terapia Neurológica</option>
                            <option value="Terapia Ortopédica">Terapia Ortopédica</option>
                            <option value="Terapia Geriátrica">Terapia Geriátrica</option>
                            <option value="Terapia Pediátrica">Terapia Pediátrica</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Terapeuta
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Event delegation para botones de acción
    document.querySelector('tbody').addEventListener('click', function(e) {
        const button = e.target.closest('button[data-action]');
        if (!button) return;
        
        const action = button.dataset.action;
        const id = button.dataset.id;
        
        if (action === 'view') {
            viewTherapist(id);
        } else if (action === 'edit') {
            editTherapist(id);
        }
    });
});

function viewTherapist(id) {
    alert('Ver detalles del terapeuta #' + id);
    // Implementar vista detallada
}

function editTherapist(id) {
    alert('Editar terapeuta #' + id);
    // Implementar edición
}
</script>
{% endblock %}
